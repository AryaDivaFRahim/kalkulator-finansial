<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Kalkulator Finansial</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container calculator-page" style="max-width: 450px; margin-top: 5vh;">
        <div class="calculator-header">
            <i class="fas fa-sign-in-alt"></i>
            <h1>Selamat Datang Kembali</h1>
            <p>Silakan masuk untuk mengakses perencana keuangan Anda.</p>
        </div>

        <div class="calculator-form-container">
            <form id="login-form">
                <div class="form-group">
                    <label for="email">Alamat Email</label>
                    <input type="email" id="email" name="email" required>
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" name="password" required>
                </div>
                <button type="submit" class="btn-calculate">
                    <i class="fas fa-paper-plane"></i> Login
                </button>
            </form>
        </div>
        
        <div id="error-message" class="error-box" style="display: none; margin-top: 15px;"></div>
    </div>

    <!-- PENTING: Firebase SDK Scripts -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    
    <script>
        // --- PASTE KONFIGURASI FIREBASE ANDA DI SINI ---
        // INI ADALAH BAGIAN PALING PENTING. Hapus objek lama dan
        // tempelkan 'firebaseConfig' yang baru saja Anda salin dari Firebase Console.
        const firebaseConfig = {
            apiKey: "AIzaSyAixzUJEqSYNgIpkTTvfPVl2dofmShI4uk",
            authDomain: "kalkulator-finansial-anda.firebaseapp.com",
            projectId: "kalkulator-finansial-anda",
            storageBucket: "kalkulator-finansial-anda.firebasestorage.app",
            messagingSenderId: "821114356227",
            appId: "1:821114356227:web:0e8ad3e33355a4a079c436"
        };

        // Inisialisasi Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }

        const loginForm = document.getElementById('login-form');
        const errorMessageDiv = document.getElementById('error-message');

        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            errorMessageDiv.style.display = 'none'; // Sembunyikan pesan error lama

            const email = loginForm.email.value;
            const password = loginForm.password.value;

            firebase.auth().signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    return userCredential.user.getIdToken(true);
                })
                .then((idToken) => {
                    return fetch('/session-login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ token: idToken })
                    });
                })
                .then(response => {
                    if (response.ok) {
                        window.location.href = "{{ url_for('main.index') }}";
                    } else {
                        throw new Error('Gagal membuat sesi di server.');
                    }
                })
                .catch((error) => {
                    let friendlyMessage = "Terjadi kesalahan. Silakan coba lagi.";
                    if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
                        friendlyMessage = "Email atau password yang Anda masukkan salah.";
                    }
                    console.error("Firebase Login Error:", error);
                    errorMessageDiv.textContent = friendlyMessage;
                    errorMessageDiv.style.display = 'block';
                });
        });
    </script>
</body>
</html>

